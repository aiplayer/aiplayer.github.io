<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Javascript,Events 和DOM API | aiplayer</title>
    <meta name="description" content="aiplayer portal">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.f0b62ee8.css" as="style"><link rel="preload" href="/assets/js/app.db1f5619.js" as="script"><link rel="preload" href="/assets/js/2.136755fd.js" as="script"><link rel="preload" href="/assets/js/26.f94f11ad.js" as="script"><link rel="prefetch" href="/assets/js/10.d8e1a177.js"><link rel="prefetch" href="/assets/js/100.a1569435.js"><link rel="prefetch" href="/assets/js/101.df4254c0.js"><link rel="prefetch" href="/assets/js/102.7238a621.js"><link rel="prefetch" href="/assets/js/103.6066a045.js"><link rel="prefetch" href="/assets/js/104.19e5f9ce.js"><link rel="prefetch" href="/assets/js/105.1da234c6.js"><link rel="prefetch" href="/assets/js/106.205e3402.js"><link rel="prefetch" href="/assets/js/107.175ad760.js"><link rel="prefetch" href="/assets/js/108.a9ac042b.js"><link rel="prefetch" href="/assets/js/109.424d5783.js"><link rel="prefetch" href="/assets/js/11.934355de.js"><link rel="prefetch" href="/assets/js/110.c7bca671.js"><link rel="prefetch" href="/assets/js/111.73c2c60a.js"><link rel="prefetch" href="/assets/js/112.7f5490ea.js"><link rel="prefetch" href="/assets/js/113.14375c6f.js"><link rel="prefetch" href="/assets/js/114.3363197a.js"><link rel="prefetch" href="/assets/js/115.02afb483.js"><link rel="prefetch" href="/assets/js/116.29a7b694.js"><link rel="prefetch" href="/assets/js/117.5be07a33.js"><link rel="prefetch" href="/assets/js/118.0702142c.js"><link rel="prefetch" href="/assets/js/119.6402e457.js"><link rel="prefetch" href="/assets/js/12.c2bc3227.js"><link rel="prefetch" href="/assets/js/120.ac365fc7.js"><link rel="prefetch" href="/assets/js/121.fb021e50.js"><link rel="prefetch" href="/assets/js/122.9fe3b1ea.js"><link rel="prefetch" href="/assets/js/123.27e74ba8.js"><link rel="prefetch" href="/assets/js/124.1d2e32db.js"><link rel="prefetch" href="/assets/js/125.04e7f173.js"><link rel="prefetch" href="/assets/js/126.27d517fd.js"><link rel="prefetch" href="/assets/js/127.64ce51be.js"><link rel="prefetch" href="/assets/js/128.5c40af31.js"><link rel="prefetch" href="/assets/js/129.8e36099a.js"><link rel="prefetch" href="/assets/js/13.30b2fd23.js"><link rel="prefetch" href="/assets/js/130.4404aeed.js"><link rel="prefetch" href="/assets/js/131.9a6be204.js"><link rel="prefetch" href="/assets/js/132.621634ca.js"><link rel="prefetch" href="/assets/js/133.4b393036.js"><link rel="prefetch" href="/assets/js/134.dcc9e5f3.js"><link rel="prefetch" href="/assets/js/135.cdc08eed.js"><link rel="prefetch" href="/assets/js/136.d1361c7f.js"><link rel="prefetch" href="/assets/js/137.70e249cd.js"><link rel="prefetch" href="/assets/js/138.ab5deb19.js"><link rel="prefetch" href="/assets/js/139.11778cf5.js"><link rel="prefetch" href="/assets/js/14.2125223a.js"><link rel="prefetch" href="/assets/js/140.db04184d.js"><link rel="prefetch" href="/assets/js/141.f31f6358.js"><link rel="prefetch" href="/assets/js/142.46e9b5b9.js"><link rel="prefetch" href="/assets/js/143.fa46c1c3.js"><link rel="prefetch" href="/assets/js/144.578e8fe1.js"><link rel="prefetch" href="/assets/js/145.d92b6019.js"><link rel="prefetch" href="/assets/js/146.7959a0f8.js"><link rel="prefetch" href="/assets/js/147.bddc1b3f.js"><link rel="prefetch" href="/assets/js/148.226bfada.js"><link rel="prefetch" href="/assets/js/149.d8549551.js"><link rel="prefetch" href="/assets/js/15.fb8b9ae9.js"><link rel="prefetch" href="/assets/js/150.9e86241e.js"><link rel="prefetch" href="/assets/js/151.796f1274.js"><link rel="prefetch" href="/assets/js/152.d257e8a9.js"><link rel="prefetch" href="/assets/js/153.03854e57.js"><link rel="prefetch" href="/assets/js/154.36494ed7.js"><link rel="prefetch" href="/assets/js/155.a4c0d865.js"><link rel="prefetch" href="/assets/js/156.a5570edb.js"><link rel="prefetch" href="/assets/js/157.d5cfe341.js"><link rel="prefetch" href="/assets/js/16.4840c375.js"><link rel="prefetch" href="/assets/js/17.3db7187c.js"><link rel="prefetch" href="/assets/js/18.3f978365.js"><link rel="prefetch" href="/assets/js/19.0a024717.js"><link rel="prefetch" href="/assets/js/20.8bce2b97.js"><link rel="prefetch" href="/assets/js/21.eb505a2a.js"><link rel="prefetch" href="/assets/js/22.ad76dfcb.js"><link rel="prefetch" href="/assets/js/23.c086b548.js"><link rel="prefetch" href="/assets/js/24.3fb5d63e.js"><link rel="prefetch" href="/assets/js/25.5595455f.js"><link rel="prefetch" href="/assets/js/27.f289b5d4.js"><link rel="prefetch" href="/assets/js/28.6eb0556e.js"><link rel="prefetch" href="/assets/js/29.8defe1c0.js"><link rel="prefetch" href="/assets/js/3.28f81bc4.js"><link rel="prefetch" href="/assets/js/30.8ab8f249.js"><link rel="prefetch" href="/assets/js/31.33b536a9.js"><link rel="prefetch" href="/assets/js/32.7df14067.js"><link rel="prefetch" href="/assets/js/33.fbabe129.js"><link rel="prefetch" href="/assets/js/34.53ff114a.js"><link rel="prefetch" href="/assets/js/35.f2c39ebd.js"><link rel="prefetch" href="/assets/js/36.467f6b09.js"><link rel="prefetch" href="/assets/js/37.9e1dd23b.js"><link rel="prefetch" href="/assets/js/38.068c85f4.js"><link rel="prefetch" href="/assets/js/39.b1e0fefa.js"><link rel="prefetch" href="/assets/js/4.8934782b.js"><link rel="prefetch" href="/assets/js/40.bb170fba.js"><link rel="prefetch" href="/assets/js/41.f3ae6a10.js"><link rel="prefetch" href="/assets/js/42.bb54411b.js"><link rel="prefetch" href="/assets/js/43.3c863cb9.js"><link rel="prefetch" href="/assets/js/44.7060ca63.js"><link rel="prefetch" href="/assets/js/45.f3047d76.js"><link rel="prefetch" href="/assets/js/46.9c09c0ab.js"><link rel="prefetch" href="/assets/js/47.5202a7c1.js"><link rel="prefetch" href="/assets/js/48.6e8df322.js"><link rel="prefetch" href="/assets/js/49.0cc3d23d.js"><link rel="prefetch" href="/assets/js/5.a0353814.js"><link rel="prefetch" href="/assets/js/50.3b307fd5.js"><link rel="prefetch" href="/assets/js/51.4fbbe6c7.js"><link rel="prefetch" href="/assets/js/52.331937fe.js"><link rel="prefetch" href="/assets/js/53.dc7c275c.js"><link rel="prefetch" href="/assets/js/54.4f85d82e.js"><link rel="prefetch" href="/assets/js/55.1643757b.js"><link rel="prefetch" href="/assets/js/56.ef32a88b.js"><link rel="prefetch" href="/assets/js/57.c7121932.js"><link rel="prefetch" href="/assets/js/58.16441501.js"><link rel="prefetch" href="/assets/js/59.4e5591f5.js"><link rel="prefetch" href="/assets/js/6.fa571ebd.js"><link rel="prefetch" href="/assets/js/60.967020e8.js"><link rel="prefetch" href="/assets/js/61.71d79f42.js"><link rel="prefetch" href="/assets/js/62.88671447.js"><link rel="prefetch" href="/assets/js/63.7f40e91d.js"><link rel="prefetch" href="/assets/js/64.ef23913e.js"><link rel="prefetch" href="/assets/js/65.63a29bbb.js"><link rel="prefetch" href="/assets/js/66.9f830dea.js"><link rel="prefetch" href="/assets/js/67.0783e6f9.js"><link rel="prefetch" href="/assets/js/68.edb28c91.js"><link rel="prefetch" href="/assets/js/69.58a85f29.js"><link rel="prefetch" href="/assets/js/7.b690ca65.js"><link rel="prefetch" href="/assets/js/70.58d4adb6.js"><link rel="prefetch" href="/assets/js/71.0e2e4dba.js"><link rel="prefetch" href="/assets/js/72.ee7e2979.js"><link rel="prefetch" href="/assets/js/73.935f8492.js"><link rel="prefetch" href="/assets/js/74.d69c06e4.js"><link rel="prefetch" href="/assets/js/75.8afa1dc5.js"><link rel="prefetch" href="/assets/js/76.48c0a6d0.js"><link rel="prefetch" href="/assets/js/77.5e0afc33.js"><link rel="prefetch" href="/assets/js/78.9cb7dc28.js"><link rel="prefetch" href="/assets/js/79.83ec5e2e.js"><link rel="prefetch" href="/assets/js/8.f127e12e.js"><link rel="prefetch" href="/assets/js/80.3776af5c.js"><link rel="prefetch" href="/assets/js/81.539223a8.js"><link rel="prefetch" href="/assets/js/82.ecd88fed.js"><link rel="prefetch" href="/assets/js/83.8b8f52b1.js"><link rel="prefetch" href="/assets/js/84.56e7b62b.js"><link rel="prefetch" href="/assets/js/85.602daf28.js"><link rel="prefetch" href="/assets/js/86.8983b155.js"><link rel="prefetch" href="/assets/js/87.92548279.js"><link rel="prefetch" href="/assets/js/88.1683e878.js"><link rel="prefetch" href="/assets/js/89.57d67dae.js"><link rel="prefetch" href="/assets/js/9.beeca559.js"><link rel="prefetch" href="/assets/js/90.86c4ccad.js"><link rel="prefetch" href="/assets/js/91.b97628b5.js"><link rel="prefetch" href="/assets/js/92.13b4c677.js"><link rel="prefetch" href="/assets/js/93.91e9ad39.js"><link rel="prefetch" href="/assets/js/94.bfd2d19e.js"><link rel="prefetch" href="/assets/js/95.89405747.js"><link rel="prefetch" href="/assets/js/96.de120589.js"><link rel="prefetch" href="/assets/js/97.72fa8b0f.js"><link rel="prefetch" href="/assets/js/98.debed4eb.js"><link rel="prefetch" href="/assets/js/99.992e6d93.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f0b62ee8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">aiplayer</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/arjs/" class="nav-link">
  AR.js
</a></div><div class="nav-item"><a href="/aframe/" class="nav-link router-link-active">
  aframe
</a></div><div class="nav-item"><a href="/nunustudio/" class="nav-link">
  nunuStudio
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div> <a href="https://github.com/aiplayer/aiplayer.github.io.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    Aiplayer
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/arjs/" class="nav-link">
  AR.js
</a></div><div class="nav-item"><a href="/aframe/" class="nav-link router-link-active">
  aframe
</a></div><div class="nav-item"><a href="/nunustudio/" class="nav-link">
  nunuStudio
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div> <a href="https://github.com/aiplayer/aiplayer.github.io.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    Aiplayer
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>aframe</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/aframe/" class="sidebar-link">AFrame:构建VR应用框架</a></li><li><a href="/aframe/aframe-base.html" class="sidebar-link">AFrame基础</a></li><li><a href="/aframe/aframe-guide.html" class="sidebar-link">开发指南</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>API</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/aframe/aframe-api.html" class="sidebar-link">核心API</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>组件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/aframe/aframe-component.html" class="sidebar-link">组件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>原语</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/aframe/aframe-primitive.html" class="sidebar-link">AFrame基础控件</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript-events-和dom-api"><a href="#javascript-events-和dom-api" class="header-anchor">#</a> Javascript,Events 和DOM API</h1> <p>因为A-Frame只是HTML，所以我们可以使用JavaScript和domapi来控制场景及其实体，就像我们通常在web开发中那样。</p> <p>场景中的每个元素，甚至是<a-box>或<a-sky>等元素，都是实体（表示为<a-entity>）。A-Frame修改HTML元素原型，为某些domapi添加一些额外的行为，使其适合A-Frame。有关下面讨论的大多数API的参考，请参阅实体API文档。</a-entity></a-sky></a-box></p> <h2 id="在何处放置a-frame的javascript代码"><a href="#在何处放置a-frame的javascript代码" class="header-anchor">#</a> 在何处放置A-Frame的JavaScript代码</h2> <p>重要提示：在我们讨论使用JavaScript和domapi的不同方法之前，我们规定将JavaScript代码封装在A-Frame组件中。组件模块化代码，使逻辑和行为在HTML中可见，并确保代码在正确的时间执行（例如，在场景和实体附加和初始化之后）。作为最基本的示例，要在<a-scene>之前注册console.log组件：</a-scene></p> <div class="language- extra-class"><pre class="language-text"><code>AFRAME.registerComponent('log', {
  schema: {type: 'string'},

  init: function () {
    var stringToLog = this.data;
    console.log(stringToLog);
  }
});
</code></pre></div><p>注册后，使用HTML中的组件：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;a-scene log=&quot;Hello, Scene!&quot;&gt;
  &lt;a-box log=&quot;Hello, Box!&quot;&gt;&lt;/a-box&gt;
&lt;/a-scene&gt;
</code></pre></div><p>组件将我们的所有代码封装为可重用、声明性和可共享的。不过，如果我们只是在运行时闲逛，我们可以使用浏览器的开发工具控制台在场景中运行JavaScript。</p> <p>不要像使用传统的2D脚本那样，尝试在<A-scene>后面的raw<code>&lt;script&gt;</code>标记中放置与A-Frame相关的JavaScript。如果我们这样做了，我们就必须采取特殊措施来确保代码在正确的时间运行（请参见在场景中运行内容脚本）。</A-scene></p> <h2 id="通过查询和遍历获取实体"><a href="#通过查询和遍历获取实体" class="header-anchor">#</a> 通过查询和遍历获取实体</h2> <p>DOM作为场景图的奇妙之处在于，标准DOM提供了遍历、查询、查找和选择.querySelector（）和.querySelectorAll（）的实用程序。最初的灵感来自jQuery选择器，我们可以在MDN上学习查询选择器。</p> <p>让我们运行几个示例查询选择器。以下面的场景为例。</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;html&gt;
  &lt;a-scene&gt;
    &lt;a-box id=&quot;redBox&quot; class=&quot;clickable&quot; color=&quot;red&quot;&gt;&lt;/a-box&gt;
    &lt;a-sphere class=&quot;clickable&quot; color=&quot;blue&quot;&gt;&lt;/a-sphere&gt;
    &lt;a-box color=&quot;green&quot;&gt;&lt;/a-box&gt;
    &lt;a-entity light=&quot;type: ambient&quot;&gt;&lt;/a-entity&gt;
    &lt;a-entity light=&quot;type: directional&quot;&gt;&lt;/a-entity&gt;
  &lt;/a-scene&gt;
&lt;/html&gt;
</code></pre></div><h3 id="使用-queryselector（）"><a href="#使用-queryselector（）" class="header-anchor">#</a> 使用.querySelector（）</h3> <p>如果我们只想获取一个元素，我们使用.querySelector（）返回一个元素。让我们抓住场景元素：</p> <div class="language- extra-class"><pre class="language-text"><code>var sceneEl = document.querySelector('a-scene');
</code></pre></div><p>注意如果我们在一个组件中工作，我们已经有了对scene元素的引用，而不需要查询。所有实体都引用其场景元素：</p> <div class="language- extra-class"><pre class="language-text"><code>AFRAME.registerComponent('foo', {
  init: function () {
    console.log(this.el.sceneEl);  // Reference to the scene element.
  }
});
</code></pre></div><p>如果元素有ID，我们可以使用ID选择器（即#<ID>）。在对整个文档执行查询选择器之前，我们先获取一个带有ID的红色框。在这里，我们将在场景范围内执行查询选择器。使用查询选择器，我们可以将查询的范围限制在任何元素内：</ID></p> <div class="language- extra-class"><pre class="language-text"><code>var sceneEl = document.querySelector('a-scene');
console.log(sceneEl.querySelector('#redBox'));
// &lt;a-box id=&quot;redBox&quot; class=&quot;clickable&quot; color=&quot;red&quot;&gt;&lt;/a-box&gt;
</code></pre></div><h3 id="使用-queryselectorall（）"><a href="#使用-queryselectorall（）" class="header-anchor">#</a> 使用.querySelectorAll（）</h3> <p>如果要获取一组元素，我们使用.querySelectorAll（）返回一个元素数组。我们可以跨元素名称查询：</p> <div class="language- extra-class"><pre class="language-text"><code>console.log(sceneEl.querySelectorAll('a-box'));
// [
//  &lt;a-box id=&quot;redBox&quot; class=&quot;clickable&quot; color=&quot;red&quot;&gt;&lt;/a-box&gt;,
//  &lt;a-box color=&quot;green&quot;&gt;&lt;/a-box&gt;
// ]
</code></pre></div><p>我们可以查询具有带有类选择器的类的元素（即&lt;class_NAME&gt;）。让我们抓住每个拥有可点击类的实体：</p> <div class="language- extra-class"><pre class="language-text"><code>console.log(sceneEl.querySelectorAll('.clickable'));
// [
//  &lt;a-box id=&quot;redBox&quot; class=&quot;clickable&quot; color=&quot;red&quot;&gt;&lt;/a-box&gt;
//  &lt;a-sphere class=&quot;clickable&quot; color=&quot;blue&quot;&gt;&lt;/a-sphere&gt;
// ]
</code></pre></div><p>我们可以使用属性选择器（即，[&lt;attribute\u NAME&gt;]）查询包含属性（在本例中是组件）的元素。让我们抓住每一个有光的实体：</p> <div class="language- extra-class"><pre class="language-text"><code>console.log(sceneEl.querySelectorAll('[light]'));
// [
//  &lt;a-entity light=&quot;type: ambient&quot;&gt;&lt;/a-entity&gt;
// &lt;a-entity light=&quot;type: directional&quot;&gt;&lt;/a-entity&gt;
// ]
</code></pre></div><h3 id="循环-queryselectorall-中的实体"><a href="#循环-queryselectorall-中的实体" class="header-anchor">#</a> 循环.querySelectorAll()中的实体</h3> <p>如果我们使用.querySelectorAll（）获取一组实体，我们可以使用for循环在它们上循环。让我们用*循环浏览场景中的每个元素。</p> <div class="language- extra-class"><pre class="language-text"><code>var els = sceneEl.querySelectorAll('*');
for (var i = 0; i &lt; els.length; i++) {
  console.log(els[i]);
}
</code></pre></div><h3 id="关于性能的说明"><a href="#关于性能的说明" class="header-anchor">#</a> 关于性能的说明</h3> <p>避免在每帧都被调用的tick和tock函数中使用.querySelector和.querySelector，因为在DOM上循环检索实体确实需要一些时间。相反，保留一个实体的缓存列表，预先调用查询选择器，然后在上面循环。</p> <div class="language- extra-class"><pre class="language-text"><code>AFRAME.registerComponent('query-selector-example', {
  init: function () {
    this.entities = document.querySelectorAll('.box');
  },
  
  tick: function () {
    // Don't call query selector in here, query beforehand.
    for (let i = 0; i &lt; this.entities.length; i++) {
      // Do something with entities.
    }
  }
});
</code></pre></div><h3 id="使用-getattribute-检索组件数据"><a href="#使用-getattribute-检索组件数据" class="header-anchor">#</a> 使用.getAttribute()检索组件数据</h3> <p>我们可以通过.getAttribute获取实体组件的数据。A-Frame将.getAttribute扩展为返回值而不是字符串（例如，在大多数情况下返回对象，因为组件通常由多个属性组成，或者返回like.getAttribute（'visible'）的实际布尔值。通常，.getAttribute将返回组件的内部数据对象，因此不要直接修改该对象：</p> <div class="language- extra-class"><pre class="language-text"><code>// &lt;a-entity geometry=&quot;primitive: sphere; radius: 2&quot;&gt;&lt;/a-entity&gt;
el.getAttribute('geometry');
// &gt;&gt; {&quot;primitive&quot;: &quot;sphere&quot;, &quot;radius: 2&quot;, ...}
</code></pre></div><h3 id="检索位置和刻度"><a href="#检索位置和刻度" class="header-anchor">#</a> 检索位置和刻度</h3> <p>执行el.getAttribute（'position'）或el.getAttribute（'scale'）将返回矢量3的3.js Object3D position和scale属性。请记住，修改这些对象将修改实际的实体数据。</p> <p>这是因为A-Frame允许我们修改position、rotation、scale，在three.js级别可见，为了让.getAttribute返回正确的数据，A-Frame返回实际的three.js Object3D对象。</p> <p>对于.getAttribute（'rotation'）这不是真的，因为A帧无论好坏，都使用度而不是弧度。在这种情况下，将返回具有x/y/z属性的普通JavaScript对象。如果需要在弧度较低的级别上工作，则可以通过el.Object3D.rotation检索Object3D Euler。</p> <h2 id="修改a-frame场景图"><a href="#修改a-frame场景图" class="header-anchor">#</a> 修改A-Frame场景图</h2> <p>使用JavaScript和domapi，我们可以像使用普通HTML元素那样动态地添加和删除实体。</p> <h3 id="使用-createelement（）创建实体"><a href="#使用-createelement（）创建实体" class="header-anchor">#</a> 使用.createElement（）创建实体</h3> <p>要创建实体，可以使用document.createElement。这将给我们一个空白实体：</p> <div class="language- extra-class"><pre class="language-text"><code>var el = document.createElement('a-entity');

</code></pre></div><p>但是，在将该实体附加到场景之前，它不会初始化或成为场景的一部分。</p> <h3 id="添加带有-appendchild（）的实体"><a href="#添加带有-appendchild（）的实体" class="header-anchor">#</a> 添加带有.appendChild（）的实体</h3> <p>要向DOM添加实体，可以使用.appendChild（element）。具体来说，我们想把它添加到我们的场景中。我们抓取场景，创建实体，并将实体附加到场景中。</p> <div class="language- extra-class"><pre class="language-text"><code>var sceneEl = document.querySelector('a-scene');
var entityEl = document.createElement('a-entity');
// Do `.setAttribute()`s to initialize the entity.
sceneEl.appendChild(entityEl);

</code></pre></div><p>注意.appendChild（）是浏览器中的异步操作。在实体完成对DOM的追加之前，我们不能对实体执行很多操作（例如调用.getAttribute（））。如果我们需要查询刚刚附加的实体上的属性，我们可以监听实体上加载的事件，或者将逻辑放在A-Frame组件中，以便在它准备好后执行它：</p> <div class="language- extra-class"><pre class="language-text"><code>var sceneEl = document.querySelector('a-scene');

AFRAME.registerComponent('do-something-once-loaded', {
  init: function () {
    // This will be called after the entity has properly attached and loaded.
    console.log('I am ready!');
  }
});

var entityEl = document.createElement('a-entity');
entityEl.setAttribute('do-something-once-loaded', '');
sceneEl.appendChild(entityEl);

</code></pre></div><h3 id="删除具有-removechild-的实体"><a href="#删除具有-removechild-的实体" class="header-anchor">#</a> 删除具有.removeChild()的实体</h3> <p>为了从DOM中移除实体，从而从场景中移除实体，我们从父元素中调用.removeChild（element）。如果我们有一个实体，我们必须要求其父（parentNode）移除该实体。</p> <div class="language- extra-class"><pre class="language-text"><code>entityEl.parentNode.removeChild(entityEl);
</code></pre></div><h2 id="修改实体"><a href="#修改实体" class="header-anchor">#</a> 修改实体</h2> <p>空白实体什么都不做。我们可以通过添加组件、配置组件属性和删除组件来修改实体。</p> <h3 id="使用-setattribute（）添加组件"><a href="#使用-setattribute（）添加组件" class="header-anchor">#</a> 使用.setAttribute（）添加组件</h3> <p>要添加组件，可以使用.setAttribute（componentName，data）。让我们向实体添加一个几何组件。</p> <div class="language- extra-class"><pre class="language-text"><code>entityEl.setAttribute('geometry', {
  primitive: 'box',
  height: 3,
  width: 1
});
</code></pre></div><p>或者添加社区物理组件：</p> <div class="language- extra-class"><pre class="language-text"><code>entityEl.setAttribute('dynamic-body', {
  shape: 'box',
  mass: 1.5,
  linearDamping: 0.005
});
</code></pre></div><p>与普通的HTML.setAttribute（）不同，实体的.setAttribute（）被改进为接受各种类型的参数（如对象），或者能够更新组件的单个属性。阅读有关Entity.setAttribute（）的更多信息。</p> <h2 id="使用-setattribute（）更新组件"><a href="#使用-setattribute（）更新组件" class="header-anchor">#</a> 使用.setAttribute（）更新组件</h2> <p>要更新组件，我们还使用.setAttribute（）。更新组件有几种形式。</p> <h3 id="更新单个属性组件的属性"><a href="#更新单个属性组件的属性" class="header-anchor">#</a> 更新单个属性组件的属性</h3> <p>让我们更新position组件的属性，一个属性组件。我们可以传递对象或字符串。稍微倾向于传递一个对象，这样A-Frame就不必解析字符串。</p> <div class="language- extra-class"><pre class="language-text"><code>entityEl.setAttribute('position', {x: 1, y: 2, z: -3});
// Read on to see why `entityEl.object3D.position.set(1, 2, -3)` is preferred though.
</code></pre></div><h3 id="更新多属性组件的单个属性"><a href="#更新多属性组件的单个属性" class="header-anchor">#</a> 更新多属性组件的单个属性</h3> <p>让我们更新材质组件的单个属性，一个多属性组件。我们通过向.setAttribute（）提供组件名、属性名和属性值来完成此操作：</p> <div class="language- extra-class"><pre class="language-text"><code>entityEl.setAttribute('material', 'color', 'red');

</code></pre></div><h3 id="更新多属性组件的多属性"><a href="#更新多属性组件的多属性" class="header-anchor">#</a> 更新多属性组件的多属性</h3> <p>让我们一次更新灯光组件的多个属性，一个多属性组件。我们通过向.setAttribute（）提供组件名和属性对象来实现这一点。我们将更改灯光的颜色和强度，但保持类型不变：</p> <div class="language- extra-class"><pre class="language-text"><code>// &lt;a-entity light=&quot;type: directional; color: #CAC; intensity: 0.5&quot;&gt;&lt;/a-entity&gt;
entityEl.setAttribute('light', {color: '#ACC', intensity: 0.75});
// &lt;a-entity light=&quot;type: directional; color: #ACC; intensity: 0.75&quot;&gt;&lt;/a-entity&gt;
</code></pre></div><h3 id="更新位置、旋转、缩放和可见。"><a href="#更新位置、旋转、缩放和可见。" class="header-anchor">#</a> 更新位置、旋转、缩放和可见。</h3> <p>作为特殊情况，为了获得更好的性能、内存和对实用程序的访问，我们建议通过实体的Object3D而不是通过.setAttribute直接在3.js级别修改位置、旋转、缩放和可见：</p> <div class="language- extra-class"><pre class="language-text"><code>// Examples for position.
entityEl.object3D.position.set(1, 2, 3);
entityEl.object3D.position.x += 5;
entityEl.object3D.position.multiplyScalar(5);

// Examples for rotation.
entityEl.object3D.rotation.y = THREE.Math.degToRad(45);
entityEl.object3D.rotation.divideScalar(2);

// Examples for scale.
entityEl.object3D.scale.set(2, 2, 2);
entityEl.object3D.scale.z += 1.5;

// Examples for visible.
entityEl.object3D.visible = false;
entityEl.object3D.visible = true;
</code></pre></div><p>这使我们可以跳过.setAttribute开销，而是为最常更新的组件进行简单的属性设置。在执行例如entityEl.getAttribute（'position'）；的操作时，仍然会反映3.js级别的更新；。</p> <h3 id="替换多属性组件的属性"><a href="#替换多属性组件的属性" class="header-anchor">#</a> 替换多属性组件的属性</h3> <p>让我们替换几何体组件的所有属性，一个多属性组件。我们通过提供组件名、属性的对象到.setAttribute（）和指定清除现有属性的标志来实现。我们将用新属性替换几何体的所有现有属性：</p> <div class="language- extra-class"><pre class="language-text"><code>// &lt;a-entity geometry=&quot;primitive: cylinder; height: 4; radius: 2&quot;&gt;&lt;/a-entity&gt;
entityEl.setAttribute('geometry', {primitive: 'torusKnot', p: 1, q: 3, radiusTubular: 4}, true);
// &lt;a-entity geometry=&quot;primitive: torusKnot; p: 1; q: 3; radiusTubular: 4&quot;&gt;&lt;/a-entity&gt;

</code></pre></div><h2 id="使用-removeattribute（）删除组件"><a href="#使用-removeattribute（）删除组件" class="header-anchor">#</a> 使用.removeAttribute（）删除组件</h2> <p>要从实体中移除或分离组件，可以使用.removeAttribute（componentName）。让我们从camera实体中移除默认的wasd控件：</p> <div class="language- extra-class"><pre class="language-text"><code>var cameraEl = document.querySelector('[camera]');
cameraEl.removeAttribute('wasd-controls');
</code></pre></div><h2 id="事件和事件侦听器"><a href="#事件和事件侦听器" class="header-anchor">#</a> 事件和事件侦听器</h2> <p>有了JavaScript和DOM，实体和组件可以很容易地相互通信：事件和事件监听器。事件是一种发送信号的方式，其他代码可以接收并响应该信号。阅读有关浏览器事件的更多信息。</p> <h3 id="使用-emit（）发出事件"><a href="#使用-emit（）发出事件" class="header-anchor">#</a> 使用.emit（）发出事件</h3> <p>A-Frame元素提供了使用.emit（eventName、eventDetail、bubbles）发出自定义事件的简单方法。例如，假设我们正在构建一个物理组件，我们希望该实体在与另一个实体碰撞时发出信号：</p> <div class="language- extra-class"><pre class="language-text"><code>entityEl.emit('physicscollided', {collidingEntity: anotherEntityEl}, false);

</code></pre></div><p>然后，代码的其他部分可以等待并侦听此事件并运行响应代码。我们可以通过事件细节作为第二个参数传递信息和数据。我们可以指定事件是否冒泡，这意味着父实体也将发出事件。所以代码的其他部分可以注册一个事件侦听器。</p> <h3 id="使用-addeventlistener（）添加事件侦听器"><a href="#使用-addeventlistener（）添加事件侦听器" class="header-anchor">#</a> 使用.addEventListener（）添加事件侦听器</h3> <p>与普通HTML元素一样，我们可以使用.addEventListener（eventName，function）注册事件侦听器。当发出侦听器注册到的事件时，将调用该函数并处理该事件。例如，从上一个示例继续物理碰撞事件：</p> <div class="language- extra-class"><pre class="language-text"><code>entityEl.addEventListener('physicscollided', function (event) {
  console.log('Entity collided with', event.detail.collidingEntity);
});

</code></pre></div><p>当实体发出physiccolled事件时，将使用event对象调用该函数。特别是在event对象中，我们有一个event细节，它包含通过事件传递的数据和信息。</p> <h3 id="使用-removeeventlistener（）删除事件侦听器"><a href="#使用-removeeventlistener（）删除事件侦听器" class="header-anchor">#</a> 使用.removeEventListener（）删除事件侦听器</h3> <p>与普通的HTML元素一样，当我们要删除事件侦听器时，可以使用.remove event listener（eventName，function）。我们必须传递侦听器注册时使用的相同事件名和函数。例如，从上一个示例继续物理碰撞事件：</p> <div class="language- extra-class"><pre class="language-text"><code>// We have to define this function with a name if we later remove it.
function collisionHandler (event) {
  console.log('Entity collided with', event.detail.collidingEntity);
}

entityEl.addEventListener('physicscollided', collisionHandler);
entityEl.removeEventListener('physicscollided', collisionHandler);
</code></pre></div><h2 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h2> <p>A-Frame实体和原语的实现方式有利于提高性能，因此某些HTML api可能无法按预期工作。例如，当一个实体的组件被改变时，包含值的属性选择器将不起作用，变异观察者也不会触发改变。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.db1f5619.js" defer></script><script src="/assets/js/2.136755fd.js" defer></script><script src="/assets/js/26.f94f11ad.js" defer></script>
  </body>
</html>
